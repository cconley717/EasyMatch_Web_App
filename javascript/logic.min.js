function updateLastVisitTimestamp(e){firebase.database().ref("profiles/"+loggedInUID).update({lastVisitTimestamp:e}).then(function(){},function(e){alert(e)})}function prepareChatMessage(){var e=$("#chat_input").val();if(""!==e){var i=$("#send_chat").data().uid;$("#chat_input").val(""),adjustChatWindow(),sendChatMessage(i,e)}}function showLoggedInHeader(){$("#login-logout-interface").html("<a class='logo' href='/'><img alt='logo' width='200' src='images/logo.png'/></a><nav class='nav font-gotham-medium'><ul class='user-links list-inline pull-right'><li><a id='messages' class='header-link-signup text-uppercase nav-link'>Messages</a></li><li><a id='profile' class='header-link-signup text-uppercase nav-link'>Profile</a></li><li><a id='logout' class='text-uppercase nav-link'>Logout</a></li></ul></nav>"),configureMessagesButton(),configureProfileButton(),configureLogoutButton()}function configureMessagesButton(){$("#messages").on("click",function(){$("#profile_images_container-inner").html(new Spinner({color:"#000",top:"50%",left:"50%"}).spin().el),firebase.database().ref("inboxes/"+loggedInUID+"/conversations").once("value",function(e){function i(e,i){$("#"+e.key).replaceWith("<img id="+e.key+' alt="profile image" class=profile_image src='+i+"/>"),$(function(){$.contextMenu({selector:"#"+e.key,trigger:"left",callback:function(o,n){if("open_chat"===o){var t=e.key;$("#send_chat").data().uid=t,$("#chat_messages").html(""),firebase.database().ref("inboxes/"+loggedInUID).child(t).on("child_added",function(e){loggedInUID==e.val().uid?$("#chat_messages").append('<div class="row msg_container base_receive"><div class="col-md-2 col-xs-2 avatar"><img src='+firebase.auth().currentUser.photoURL+' alt="profile image" class="img-responsive profile_image2" onload="scrollBottom()"/></div><div class="col-md-10 col-xs-10"><div class="messages msg_receive"><p>'+e.val().message+"</p></div></div></div>"):$("#chat_messages").append('<div class="row msg_container base_sent"><div class="col-md-10 col-xs-10 "><div class="messages msg_sent"><p>'+e.val().message+'</p></div></div><div class="col-md-2 col-xs-2 avatar"><img src='+i+' alt="profile image" class="img-responsive profile_image2" onload="scrollBottom()"/></div></div>')}),$("#search-header").fadeOut(500),$("#profile_images_container").fadeOut(500,function(){$("#chat-container").fadeIn(500),adjustChatWindow()})}else"view_profile"===o?firebase.database().ref("profiles").child(e.key).on("value",function(o){var n=o.val().age,t=o.val().height,a=o.val().major,l=o.val().university,r=o.val().about;showProfileModal(n,t,a,l,r,e.key,i,!1)}):"remove_chat"===o&&firebase.database().ref("inboxes/"+loggedInUID+"/conversations").child(e.key).remove().then(function(){firebase.database().ref("inboxes/"+loggedInUID).child(e.key).remove().then(function(){$("#"+e.key).remove()},function(e){alert(e)})},function(e){alert(e)})},items:{open_chat:{name:"Open Chat",icon:"edit"},view_profile:{name:"View Profile",icon:"loading"},sep1:"---------",remove_chat:{name:"Remove",icon:"delete"}}})})}$("#profile_images_container-inner").html(""),e.forEach(function(e){$("<div />",{id:e.key,"class":"profile_image",style:"position: relative;"}).appendTo($("#profile_images_container-inner")),$("#"+e.key).html(new Spinner({color:"#000",top:"50%",left:"50%"}).spin().el),firebase.storage().ref().child("profileimages/"+e.key).getDownloadURL().then(function(o){i(e,o)},function(i){$("#"+e.key).remove()})})})})}function configureProfileButton(){var e,i;$("#profile").on("click",function(){e=null,i=!0,$("#modal-popup-container-inner").html(""),$("#modal-popup-container-inner").append('<div class="modal-header"><span class="close">&times;</span><h2>Your Profile</h2></div>'),$(".close").on("click",function(){closeCurrentPopup()}),$("#modal-popup-container-inner").append('<div id="modal-body-container" class="modal-body"><div id="profile_image_container" style="text-align: center; position: relative; height: 250px;"><img id="destination_profile_image" alt="profile image" style="visibility: hidden;"/><img id="source_profile_image" alt="profile image"/>&nbsp;<img id="rotateProfileImage" style="display: none; cursor: pointer;" src="images/rotate.png"/><input id="profile_image" name="file" type="file"></div><div><div class="profile-input-container"><select id="profile_gender" class="profile-input-element"><option value="" disabled selected>I am...</option><option value="male">Male</option><option value="female">Female</option></select></div><div class="profile-input-container"><select id="profile_seeking" class="profile-input-element"><option value="" disabled selected>Seeking...</option><option value="male">Male</option><option value="female">Female</option></select></div><div class="profile-input-container"><select id="profile_age" class="profile-input-element"><option value="" disabled selected>Age</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option><option value="22">22</option><option value="23">23</option><option value="24">24</option><option value="25">25</option><option value="26">26</option><option value="27">27</option><option value="28">28</option><option value="29">29</option><option value="30">30</option><option value="31">31</option><option value="32">32</option><option value="33">33</option><option value="34">34</option><option value="35">35</option></select></div><div class="profile-input-container"><select id="profile_height" class="profile-input-element"><option value="" disabled selected>Height</option><option value="< 5&apos;">< 5&apos;</option><option value="5&apos;0&quot;">5&apos;0&quot;</option><option value="5&apos;1&quot;">5&apos;1&quot;</option><option value="5&apos;2&quot;">5&apos;2&quot;</option><option value="5&apos;3&quot;">5&apos;3&quot;</option><option value="5&apos;4&quot;">5&apos;4&quot;</option><option value="5&apos;5&quot;">5&apos;5&quot;</option><option value="5&apos;6&quot;">5&apos;6&quot;</option><option value="5&apos;7&quot;">5&apos;7&quot;</option><option value="5&apos;8&quot;">5&apos;8&quot;</option><option value="5&apos;9&quot;">5&apos;9&quot;</option><option value="5&apos;10&quot;">5&apos;10&quot;</option><option value="5&apos;11&quot;">5&apos;11&quot;</option><option value="6&apos;0&quot;">6&apos;0&quot;</option><option value="6&apos;1&quot;">6&apos;1&quot;</option><option value="6&apos;2&quot;">6&apos;2&quot;</option><option value="6&apos;3&quot;">6&apos;3&quot;</option><option value="6&apos;4&quot;">6&apos;4&quot;</option><option value="6&apos;5&quot;">6&apos;5&quot;</option><option value="6&apos;6&quot;">6&apos;6&quot;</option><option value="6&apos;7&quot;">6&apos;7&quot;</option><option value="6&apos;8&quot;">6&apos;8&quot;</option><option value="6&apos;9&quot;">6&apos;9&quot;</option><option value="6&apos;10&quot;">6&apos;10&quot;</option><option value="6&apos;11&quot;">6&apos;11&quot;</option><option value="7&apos;0&quot;">7&apos;0&quot;</option><option value="> 7&apos;">> 7&apos;</option></select></div><div class="profile-input-container"><select id="profile_university" class="profile-input-element"><option value="" disabled selected>Select Your University</option><option value="University of California Berkeley">University of California Berkeley</option><option value="University of California Davis">University of California Davis</option><option value="University of California Irvine">University of California Irvine</option><option value="University of California Los Angeles">University of California Los Angeles</option><option value="University of California Merced">University of California Merced</option><option value="University of California Riverside">University of California Riverside</option><option value="University of California San Diego">University of California San Diego</option><option value="University of California San Francisco">University of California San Francisco</option><option value="University of California Santa Barbara">University of California Santa Barbara</option><option value="University of California Santa Cruz">University of California Santa Cruz</option></select></div><div class="profile-input-container"><input id="profile_major" placeholder="Your Major" class="profile-input-element"></div><div class="profile-input-container"><textarea id="profile_about" placeholder="Tell us a bit about yourself!" class="profile-input-element"></textarea></div></div></div>'),$("#profile_image_container").prepend(new Spinner({color:"#000",top:"50%",left:"50%"}).spin().el),firebase.database().ref("profiles").child(loggedInUID).once("value").then(function(e){function o(e){$("#profile_image_container").find("div").first().remove(),$("#destination_profile_image").css({visibility:""}),$("#destination_profile_image").attr("src",e),$("#destination_profile_image").on("click",function(){$("#profile_image").trigger("click")})}if(null!=e.val()){firebase.storage().ref("profileimages").child(loggedInUID).getDownloadURL().then(function(e){i=!1,o(e)},function(e){"storage/object-not-found"===e.code?(i=!0,o("images/profile_image.png")):alert(e)});var n=e.val().gender,t=e.val().seeking,a=e.val().age,l=e.val().height,r=e.val().university,s=e.val().major,p=e.val().about;$("#profile_gender").val(n).change(),$("#profile_seeking").val(t).change(),$("#profile_age").val(a).change(),$("#profile_height").val(l).change(),$("#profile_university").val(r).change(),$("#profile_major").val(s),$("#profile_about").val(p)}else i=!0},function(e){alert(e)}),$("#profile_image").change(function(){var i=document.getElementById("profile_image").files[0],o=document.getElementById("source_profile_image"),n=document.getElementById("destination_profile_image");o.src=window.URL.createObjectURL(i),o.onload=function(){var i,t,a,l=250;o.height<o.width?(i=o.height,t=o.width/2-o.height/2,a=0):(i=o.width,t=0,a=o.height/2-o.width/2),e=document.createElement("canvas"),e.width=l,e.height=l;var r=e.getContext("2d");r.drawImage(o,t,a,i,i,0,0,l,l),n.src=e.toDataURL(),r.restore(),$("#rotateProfileImage").css({display:""}),$("#rotateProfileImage").on("click",function(){r.clearRect(0,0,e.width,e.height),r.save(),r.translate(e.width/2,e.height/2),r.rotate(90*Math.PI/180),r.drawImage(n,-n.width/2,-n.width/2),r.restore(),n.src=e.toDataURL()})}}),$("#modal-popup-container-inner").append('<div class="modal-footer" style="text-align: center;"><button id="profile_submit">Update Profile</button></div>'),$("#modal-popup-container-inner").attr("class","modal-content modal-content-top-animation"),$("#modal-popup-container").css({display:"block"}),$("#profile_submit").on("click",function(){function o(e,i){function o(){firebase.database().ref("profiles/"+loggedInUID).update({hasProfile:!0}).then(function(){hasProfile=!0},function(e){alert(e)})}$("#profile_submit").text("...please wait..."),$("#profile_submit").prop("disabled",!0),firebase.database().ref("profiles/"+loggedInUID).update(e).then(function(){null!=i?firebase.storage().ref().child("profileimages/"+loggedInUID).put(i).then(function(e){firebase.auth().currentUser.updateProfile({photoURL:e.downloadURL}),o(),closeCurrentPopup()},function(e){alert(e)}):(o(),closeCurrentPopup())},function(e){alert(e)})}function n(){var e=$("#profile_gender").val(),i=$("#profile_seeking").val(),o=$("#profile_age").val(),n=$("#profile_height").val(),t=$("#profile_university").val(),a=$("#profile_major").val(),l=$("#profile_about").val();return null==e||null==i||null==o||null==n||null==t||null==a||null==l?!1:!0}function t(e){var i={gender:$("#profile_gender").val(),seeking:$("#profile_seeking").val(),age:$("#profile_age").val(),height:$("#profile_height").val(),university:$("#profile_university").val(),major:$("#profile_major").val(),about:$("#profile_about").val()};return e&&(i.creationTimestamp=Date.now()),i}if(null==e&&i)alert("You must upload an image");else if(null!=e||i){if(null!=e&&i||null!=e&&!i){var a=document.getElementById("destination_profile_image");blobUtil.imgSrcToBlob(a.src,"image/jpeg","Anonymous",.5).then(function(e){null==e?alert("nothing here"):n()?o(t(i),e):alert("Please fill out all info within your profile.")})["catch"](function(e){alert(e)})}}else n()?o(t(!1),null):alert("Please fill out all info within your profile.")})})}function configureLogoutButton(){$("#logout").on("click",function(){firebase.auth().signOut().then(function(){},function(e){})})}function showLoggedOutHeader(){$("#login-logout-interface").html("<a class='logo' href='/'><img alt='logo' width='200' src='images/logo.png'/></a><nav class='nav font-gotham-medium'><ul class='user-links list-inline pull-right'><li><a id='signup' class='header-link-signup text-uppercase nav-link'>Sign up</a></li><li><a id='login' class='text-uppercase nav-link'>Login</a></li></ul></nav>"),configureSignupButton(),configureLoginButton()}function configureSignupButton(){$("#signup").on("click",function(){$("#modal-popup-container-inner").html(""),$("#modal-popup-container-inner").append('<div class="modal-header"><span class="close">&times;</span><h2>Sign Up</h2></div>'),$(".close").on("click",function(){closeCurrentPopup()}),$("#modal-popup-container-inner").append('<div id="modal-body-container" class="modal-body" style="text-align: center;"><div style="display: inline-block; width: 60%;"><br><input id="signup-email" placeholder="email" type="text" style="width: 100%; box-sizing : border-box;"><br><input id="signup-password" placeholder="password" type="text" style="width: 100%; box-sizing : border-box;"><div><br><button id="signup-submit">submit</button><br><br></div></div></div>'),$("#modal-popup-container-inner").append('<div class="modal-footer"><br></div>'),$("#signup-submit").on("click",function(){var e=$("#signup-email").val(),i=$("#signup-password").val();firebase.auth().createUserWithEmailAndPassword(e,i).then(function(e){},function(e){alert(e.message)})}),$("#modal-popup-container-inner").attr("class","modal-content modal-content-top-animation"),$("#modal-popup-container").css({display:"block"})})}function configureLoginButton(){$("#login").on("click",function(){$("#modal-popup-container-inner").html(""),$("#modal-popup-container-inner").append('<div class="modal-header"><span class="close">&times;</span><h2>Log In</h2></div>'),$(".close").on("click",function(){closeCurrentPopup()}),$("#modal-popup-container-inner").append('<div id="modal-body-container" class="modal-body" style="text-align: center;"><div id="login-container" style="display: inline-block; width: 60%;"><br><input id="login-email" placeholder="email" type="text" style="width: 100%; box-sizing : border-box;"><br><input id="login-password" placeholder="password" type="text" style="width: 100%; box-sizing : border-box;"><div><br><button id="login-forgot">forgot password</button>&nbsp;&nbsp;&nbsp;<button id="login-submit">submit</button><br><br><button onclick="googleSignIn()">Sign in with Google</button></div></div></div>'),$("#login-forgot").on("click",function(){$("#login-container").html('<br><input id="forgot-email" placeholder="email" type="text" style="width: 100%; box-sizing : border-box;"><br><div><br><button id="forgot-submit">submit</button><br><br></div>'),$("#forgot-submit").on("click",function(){var e=$("#forgot-email").val();$(this).prop("disabled",!0),firebase.auth().sendPasswordResetEmail(e).then(function(){closeCurrentPopup(),alert("An email has been sent with password reset instructions.")},function(e){$(this).prop("disabled",!1),"auth/user-not-found"===e.code?alert("An account was not found with that email."):alert(e.message)})})}),$("#login-submit").on("click",function(){var e=$("#login-email").val(),i=$("#login-password").val();firebase.auth().signInWithEmailAndPassword(e,i).then(function(e){},function(e){alert(e)})}),$("#modal-popup-container-inner").append('<div class="modal-footer"><br></div>'),$("#modal-popup-container-inner").attr("class","modal-content modal-content-top-animation"),$("#modal-popup-container").css({display:"block"})})}function performSearch(e,i,o,n){$("#profile_images_container-inner").html(new Spinner({color:"#000",top:"50%",left:"50%"}).spin().el),firebase.database().ref("profiles").orderByChild("university").equalTo(o).once("value").then(function(o){function t(e,i){return 0==i.length?i.push(e):i.splice(a(e,i)+1,0,e),i}function a(e,i,o,n){o=o||0,n=n||i.length;var t=parseInt(o+(n-o)/2,10);return i[t].timestamp===e.timestamp?t:1>=n-o?i[t].timestamp<e.timestamp?t-1:t:i[t].timestamp>e.timestamp?a(e,i,t,n):a(e,i,o,t)}var l=[];o.forEach(function(o){if(o.val().hasProfile&&loggedInUID!==o.key&&e===o.val().seeking&&i===o.val().gender){var a={uid:o.key,age:o.val().age,height:o.val().height,major:o.val().major,about:o.val().about};"sort_last"===n?a.timestamp=o.val().lastVisitTimestamp:"sort_newest"===n&&(a.timestamp=o.val().creationTimestamp),t(a,l)}}),0==l.length?$("#profile_images_container-inner").html("<h1>No results found.</h1>"):($("#profile_images_container-inner").html(""),l.forEach(function(e){var i=e.uid,o=e.age,n=e.height,t=e.major,a=e.about;$("<div />",{id:i,"class":"profile_image",style:"position: relative;"}).appendTo($("#profile_images_container-inner")),$("#"+i).html(new Spinner({color:"#000",top:"50%",left:"50%"}).spin().el),firebase.storage().ref().child("profileimages/"+i).getDownloadURL().then(function(e){$("#"+i).replaceWith("<img id="+i+' alt="profile image" class=profile_image src='+e+"/>"),$("#"+i).on("click",function(){showProfileModal(o,n,t,null,a,this.id,this.src,!0)})},function(e){$("#"+i).remove()})}))},function(e){alert(e)})}function showProfileModal(e,i,o,n,t,a,l,r){$("#modal-popup-container-inner").html(""),r?($("#modal-popup-container-inner").append('<div class="modal-header"><span class="close">&times;</span><h2>Contact them!</h2></div>'),null==n?$("#modal-popup-container-inner").append('<div class="modal-body" style="text-align: center;"><div style="text-align: center;"><div id="profile_image_container" style="position: relative; width: 100%; height: 250px;"><img id="profile_image_inner" alt="profile image"/></div><div style="width: 100%;"><b>Age: </b>'+e+"<br><b>Height: </b>"+i+"<br><b>Major: </b>"+o+"<br><b>About: </b>"+t+"</p></div></div></div>"):$("#modal-popup-container-inner").append('<div class="modal-body" style="text-align: center;"><div style="text-align: center;"><div id="profile_image_container" style="position: relative; width: 100%; height: 250px;"><img id="profile_image_inner" alt="profile image"/></div><div style="width: 100%;"><b>Age: </b>'+e+"<br><b>Height: </b>"+i+"<br><b>Major: </b>"+o+"<br><b>University: </b>"+n+"<br><b>About: </b>"+t+"</p></div></div></div>"),null==loggedInUID?$("#modal-popup-container-inner").append('<div class="modal-footer" style="text-align: center;"><div><textarea id="message-input" placeholder="Want to contact them? Enter your message here!"></textarea><button disabled>Log in to Send Messages!</button></div></div>'):hasProfile?($("#modal-popup-container-inner").append('<div class="modal-footer" style="text-align: center;"><div><textarea id="message-input" placeholder="Want to contact them? Enter your message here!"></textarea><button id="send_message">Send Message!</button></div></div>'),$("#send_message").on("click",function(){var e=$("#message-input").val();""==e?alert("Messages cannot be blank."):(sendChatMessage(a,e),closeCurrentPopup())})):$("#modal-popup-container-inner").append('<div class="modal-footer" style="text-align: center;"><div><textarea id="message-input" placeholder="Want to contact them? Enter your message here!"></textarea><button disabled>Create a Profile to Send Messages!</button></div></div>')):($("#modal-popup-container-inner").append('<div class="modal-header"><span class="close">&times;</span><h2>Profile</h2></div>'),null==n?$("#modal-popup-container-inner").append('<div class="modal-body" style="text-align: center;"><div style="text-align: center;"><div id="profile_image_container" style="position: relative; width: 100%; height: 250px;"><img id="profile_image_inner" alt="profile image"/></div><div style="width: 100%;"><b>Age: </b>'+e+"<br><b>Height: </b>"+i+"<br><b>Major: </b>"+o+"<br><b>About: </b>"+t+"</p></div></div></div>"):$("#modal-popup-container-inner").append('<div class="modal-body" style="text-align: center;"><div style="text-align: center;"><div id="profile_image_container" style="position: relative; width: 100%; height: 250px;"><img id="profile_image_inner" alt="profile image"/></div><div style="width: 100%;"><b>Age: </b>'+e+"<br><b>Height: </b>"+i+"<br><b>Major: </b>"+o+"<br><b>University: </b>"+n+"<br><b>About: </b>"+t+"</p></div></div></div>"),$("#modal-popup-container-inner").append('<div class="modal-footer" style="text-align: center;"><br></div>')),$("#profile_image_inner").attr("src",l),$(".close").on("click",function(){closeCurrentPopup()}),$("#modal-popup-container-inner").attr("class","modal-content modal-content-center-animation"),$("#modal-popup-container").css({display:"block"})}function sendChatMessage(e,i){firebase.database().ref("inboxes/"+loggedInUID+"/conversations").once("value",function(i){i.hasChild(e)||firebase.database().ref("inboxes/"+loggedInUID+"/conversations").child(e).set(!0).then(function(){},function(e){alert(e)})}),firebase.database().ref("inboxes/"+e+"/conversations").once("value",function(i){i.hasChild(loggedInUID)||firebase.database().ref("inboxes/"+e+"/conversations").child(loggedInUID).set(!0).then(function(){},function(e){alert(e)})});var o=Date.now();firebase.database().ref("inboxes/"+loggedInUID+"/"+e).child(o).set({uid:loggedInUID,message:i,timestamp:o}).then(function(){},function(e){alert(e)}),firebase.database().ref("inboxes/"+e+"/"+loggedInUID).child(o).set({uid:loggedInUID,message:i,timestamp:o}).then(function(){},function(e){alert(e)})}function showTop50Profiles(){$("#profile_images_container-inner").html(new Spinner({color:"#000",top:"50%",left:"50%"}).spin().el),firebase.database().ref("profiles").orderByChild("lastVisitTimestamp").limitToFirst(50).once("value").then(function(e){$("#profile_images_container-inner").html(""),e.forEach(function(e){var i=e.key,o=e.val().age,n=e.val().height,t=e.val().major,a=e.val().university,l=e.val().about;e.val().hasProfile&&($("<div />",{id:i,"class":"profile_image",style:"position: relative;"}).prependTo($("#profile_images_container-inner")),$("#"+i).html(new Spinner({color:"#000",top:"50%",left:"50%"}).spin().el),firebase.storage().ref().child("profileimages/"+i).getDownloadURL().then(function(e){$("#"+i).replaceWith("<img id="+i+' alt="profile image" class=profile_image src='+e+"/>"),$("#"+i).on("click",function(){showProfileModal(o,n,t,a,l,this.id,this.src,!0)})},function(e){$("#"+i).remove()}))})},function(e){alert(e)})}function closeCurrentPopup(){$(".modal-popup").css({display:"none"})}function scrollBottom(){chat_container_inner.scrollTop(chat_container_inner.prop("scrollHeight"))}function resizeDiv(){chat_container_inner.height($(window).height()-$("#account-header").height()-$("#message-input-container").height()-2)}function adjustChatWindow(){resizeDiv(),scrollBottom()}function googleSignIn(){var e=new firebase.auth.GoogleAuthProvider;firebase.auth().signInWithPopup(e).then(function(e){e.credential.accessToken,e.user})["catch"](function(e){var i=(e.code,e.message);e.email,e.credential;alert(i)})}var loggedInUID,hasProfile;firebase.auth().onAuthStateChanged(function(e){e?(loggedInUID=e.uid,showLoggedInHeader(),updateLastVisitTimestamp(Date.now()),firebase.database().ref("profiles").child(loggedInUID).once("value").then(function(e){hasProfile=e.child("hasProfile").exists()&&e.val().hasProfile?!0:!1})):(loggedInUID=null,hasProfile=!1,showLoggedOutHeader()),showTop50Profiles(),closeCurrentPopup()}),$("#close_chat").on("click",function(){$("#chat-container").fadeOut(500,function(){$("#search-header").fadeIn(500),$("#profile_images_container").fadeIn(500)});var e=$("#send_chat").data().uid;firebase.database().ref("inboxes/"+loggedInUID).child(e).off()}),$("#send_chat").on("click",function(){prepareChatMessage()}),$("#chat_input").keypress(function(e){var i=e.keyCode?e.keyCode:e.which;"13"==i&&prepareChatMessage()}),$("#search").on("click",function(){var e=$("#search_gender").val(),i=$("#search_seeking").val(),o=$("#search_university").val(),n=$("#search_sort").val();null==e||null==i||null==o?alert("Please specify your search terms."):($.contextMenu("destroy"),performSearch(e,i,o,n))}),$(window).on("click",function(e){e.target==$(".modal-popup")[0]&&closeCurrentPopup()});var chat_container_inner=$("#chat-container-inner");$(window).ready(function(){adjustChatWindow()}),$(window).bind("resize",function(){adjustChatWindow()});